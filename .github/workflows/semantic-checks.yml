name: Semantic Checks

on:
  # Both events are used, but jobs will selectively run depending on event type.
  pull_request:
    types: [opened, edited, synchronize, reopened]
  pull_request_target:
    types: [opened, edited, synchronize, reopened]

permissions:
  contents: read
  pull-requests: read

jobs:
  # --------------------------------------------------------
  # ✅ Check PR Title
  # Runs under `pull_request_target` to get PR metadata safely.
  # --------------------------------------------------------
  semantic-pr-title:
    if: github.event_name == 'pull_request_target'
    name: Check PR Title
    runs-on: ubuntu-latest
    steps:
      - name: Validate PR Title
        uses: amannn/action-semantic-pull-request@v5
        env:
          GITHUB_TOKEN: ${{ secrets.GITHUB_TOKEN }}
        with:
          types: |
            feat
            fix
            docs
            style
            refactor
            perf
            test
            build
            ci
            chore
            revert
          requireScope: false
          wip: true
          validateSingleCommit: true

  # --------------------------------------------------------
  # ✅ Check Branch Name
  # Runs under `pull_request` (safe, doesn't need repo-level perms).
  # --------------------------------------------------------
  semantic-branch-name:
    if: github.event_name == 'pull_request'
    name: Check Branch Name
    runs-on: ubuntu-latest
    steps:
      - name: Check branch name
        uses: deepakputhraya/action-branch-name@master
        with:
          regex: "^(main|master|develop|dev)$|^(feature|feat|fix|bugfix|hotfix|release|docs|style|refactor|perf|test|build|ci|chore|revert|dependabot)/.+$"
          allowed_prefixes: "feature,feat,fix,bugfix,hotfix,release,docs,style,refactor,perf,test,build,ci,chore,revert,dependabot"
          ignore: main,master,develop,dev
          min_length: 3
          max_length: 100

  # --------------------------------------------------------
  # ✅ Check Commit Messages
  # Runs under `pull_request` (checks the fork’s commits safely).
  # --------------------------------------------------------
  semantic-commits:
    if: github.event_name == 'pull_request'
    name: Check Commit Messages
    runs-on: ubuntu-latest
    steps:
      - name: Checkout code
        uses: actions/checkout@v4
        with:
          fetch-depth: 0

      - name: Validate commit messages
        uses: wagoid/commitlint-github-action@v6
        with:
          configFile: .commitlintrc.json
